<!-- Overlay -->
<div class="sidebar-overlay" *ngIf="isVisible" (click)="onClose()"></div>

<!-- Sidebar -->
<div class="sidebar" [class.visible]="isVisible">
    <form [formGroup]="documentForm" (ngSubmit)="onSubmit()" novalidate>
        <!-- Header -->
        <div class="sidebar-header">
            <h5 class="sidebar-title">
                {{ employeeDocument ? 'Edit Document' : 'Upload Document' }}
            </h5>
            <button type="button" class="close" (click)="onClose()">
                <span>&times;</span>
            </button>
        </div>

        <!-- Body -->
        <div class="sidebar-body">
            <div class="form-container">
                <!-- Document Type Dropdown -->
                <div class="form-group mb-3">
                    <label class="form-label">Document Type <span class="text-danger">*</span></label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="mdi mdi-file-document"></i>
                            </span>
                        </div>
                        <select class="form-control" formControlName="DocumentType"
                            [class.is-invalid]="isFieldInvalid('DocumentType')">
                            <option value="" disabled selected>-- Select Document Type --</option>
                            <option *ngFor="let type of documentTypes" [value]="type">
                                {{ type }}
                            </option>
                        </select>
                    </div>
                    <div *ngIf="isFieldInvalid('DocumentType')" class="text-danger small">
                        Please select a document type
                    </div>
                </div>

                <!-- File Upload Area -->
                <div class="form-group mb-3">
                    <label class="form-label">Upload File <span class="text-danger">*</span></label>
                    
                    <!-- Hidden File Input -->
                    <input type="file" #fileInput style="display: none" 
                           (change)="onFileSelected($event)" 
                           accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx">

                    <!-- Custom File Upload Area (using existing classes) -->
                    <div class="upload-area" 
                         (click)="fileInput.click()" 
                         (dragover)="onDragOver($event)"
                         (drop)="onDrop($event)"
                         [class.has-error]="fileError"
                         [class.has-file]="selectedFile">
                        
                        <div *ngIf="!selectedFile" class="upload-placeholder">
                            <i class="mdi mdi-cloud-upload upload-icon"></i>
                            <p class="mb-1">Drag & drop or <span class="text-primary">browse</span></p>
                            <small class="text-muted">PDF, JPG, PNG, DOC, DOCX, XLS, XLSX (Max 10MB)</small>
                        </div>

                        <div *ngIf="selectedFile" class="file-preview">
                            <div class="file-info">
                                <i class="mdi {{getFileIcon()}}" [class]="getIconClass()"></i>
                                <div class="file-details">
                                    <span class="file-name">{{ selectedFile.name }}</span>
                                    <small class="file-size">{{ formatFileSize(selectedFile.size) }}</small>
                                </div>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                    (click)="removeFile(); $event.stopPropagation()">
                                <i class="mdi mdi-close"></i>
                            </button>
                        </div>

                        <div *ngIf="fileError" class="text-danger small mt-2">
                            <i class="mdi mdi-alert-circle"></i> {{ fileError }}
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <div class="form-group mb-3">
                    <label class="form-label">Description (Optional)</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="mdi mdi-note-text"></i>
                            </span>
                        </div>
                        <textarea class="form-control" formControlName="FileInfo"
                            [class.is-invalid]="isFieldInvalid('FileInfo')" rows="3"
                            placeholder="Enter document description or notes"></textarea>
                    </div>
                </div>

                <!-- Status Toggle -->
                <div class="form-group mb-3">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" 
                               formControlName="IsActive" id="isActive" checked>
                        <label class="form-check-label" for="isActive">
                            <i class="mdi mdi-check-circle text-success me-1"></i>
                            Active Document
                        </label>
                    </div>
                    <small class="text-muted d-block mt-1">Inactive documents won't be visible in lists</small>
                </div>

                <!-- Hidden Fields -->
                <input type="hidden" formControlName="EmployeeDocumentId">
                <input type="hidden" formControlName="EmployeeId">
                <input type="hidden" formControlName="FileId">
                <input type="hidden" formControlName="FileName">
                <input type="hidden" formControlName="BucketId">
                <input type="hidden" formControlName="ContentLength">
                <input type="hidden" formControlName="ContentType">
                <input type="hidden" formControlName="UploadTimestamp">
            </div>
        </div>

        <!-- Footer -->
        <div class="sidebar-footer">
            <button type="submit" class="btn btn-primary" 
                    [disabled]="documentForm.invalid || !selectedFile || isUploading">
                <span *ngIf="isUploading" class="spinner-border spinner-border-sm me-2"></span>
                <i *ngIf="!isUploading" class="mdi mdi-cloud-upload"></i>
                {{ isUploading ? 'Uploading...' : (employeeDocument ? 'Update' : 'Upload') }}
            </button>
            <button type="button" class="btn btn-secondary ms-2 desktop-only" (click)="onClose()">
                <i class="mdi mdi-close"></i>
                Cancel
            </button>
        </div>
    </form>
</div>