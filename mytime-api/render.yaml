services:
  - type: web
    name: mytime-api
    env: python
    region: singapore
    plan: free
    rootDir: mytime-api
    
    buildCommand: |
      echo "üöÄ Installing system dependencies..."
      apt-get update
      apt-get install -y g++ unixodbc-dev curl gnupg
      
      echo "üì¶ Installing Microsoft ODBC driver..."
      curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add -
      curl https://packages.microsoft.com/config/debian/11/prod.list > /etc/apt/sources.list.d/mssql-release.list
      apt-get update
      ACCEPT_EULA=Y apt-get install -y msodbcsql17
      
      echo "üêç Installing Python packages..."
      pip install --upgrade pip
      pip install -r requirements.txt
      
      echo "‚úÖ Build completed successfully!"
    
    startCommand: gunicorn app.main:app --workers 1 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT
    
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
    
    healthCheckPath: /health
    autoDeploy: true